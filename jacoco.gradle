apply plugin: 'jacoco-android'

jacoco {
    toolVersion = "0.8.4"
    reportsDir = file("$buildDir/JacocoReport")
}

task jacocoTestReport(type: JacocoReport, dependsOn: 'testProdDebugUnitTest', overwrite: true) {
    group = "reporting"
    reports {
        xml.enabled = true
        html.enabled = true
    }
    def fileFilter = [
            '**/R.class',
            '**/R$*.class',
            '**/*$ViewInjector*.*',
            '**/*$ViewBinder*.*',
            '**/BuildConfig.*',
            '**/Manifest*.*',
            '**/*$Lambda$*.*', // Jacoco can not handle several "$" in class name.
            '**/*_MembersInjector.class',
            '**/Dagger*Component.class', // covers component implementations
            '**/Dagger*Component$Builder.class', // covers component builders
            '**/*Module_*Factory.class',
            '**/*$*$*.*', // Anonymous classes generated by kotlin

            'android/**',
            'com/google/**',
            'com/intellij/**',
            'junit/**',
            'net/**',
            'okhttp/**',
            'org/**',
            'rx/**',

            '**/databinding/*',
            '**/player/*',
            '**/ui/*'
    ]
    def mainSrc = fileTree(dir: "${project.projectDir}/src/main/java/", excludes: fileFilter)
    getSourceDirectories().setFrom(mainSrc)
    getExecutionData().setFrom("${buildDir}/outputs/code-coverage/connected/coverage.ec")
}

